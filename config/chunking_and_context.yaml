# chunking_and_context.yaml

chunking:
  default_tokens_per_chunk: 3000  # Chunk size (in tokens) for splitting the text into manageable pieces.

context: # Define whether or not to pass additional context to the model
  use_additional_context: true

matching:
  # Configuration for semantic boundary text matching in line range readjustment
  
  # normalize_whitespace: Collapse multiple whitespace characters into single spaces
  normalize_whitespace: true
  
  # case_sensitive: If false, perform case-insensitive matching
  case_sensitive: false
  
  # normalize_diacritics: Remove or normalize diacritical marks (accents, umlauts, etc.)
  # Useful for historical texts with inconsistent diacritic usage
  normalize_diacritics: true
  
  # strip_punctuation: Remove common punctuation marks before matching
  # Set to false if punctuation is semantically important (e.g., "ยง 1." vs "ยง 2.")
  strip_punctuation: false
  
  # allow_substring_match: If true, boundary text can match as a substring within a line
  # If false, the entire line (after normalization) must match exactly
  allow_substring_match: true
  
  # min_substring_length: Minimum character length for a valid boundary substring match
  # Prevents false positives from very short strings
  min_substring_length: 5

retry:
  # Configuration for retrying in semantic boundary detection
  
  # certainty_threshold: Minimum certainty score (0-100) required to accept a model response
  # Responses below this threshold trigger retries with different context windows
  certainty_threshold: 70
  
  # max_low_certainty_retries: Maximum retries when model returns certainty below threshold
  max_low_certainty_retries: 12
  
  # max_marker_mismatch_retries: Attempts to request a different semantic substring when prior markers weren't found
  max_marker_mismatch_retries: 12
    
  # max_context_expansion_attempts: Maximum number of times to expand context when model requests more context
  # This handles the needs_more_context response from the model
  max_context_expansion_attempts: 6
  
  # delete_ranges_with_no_content: If true, delete line ranges after confirming no semantic content exists
  # If the broader scan also finds no content, the range is deleted
  delete_ranges_with_no_content: true
  
  # scan_range_multiplier: Multiplier for broader scan when verifying no content
  # The scan area will be (original_range_size * multiplier) lines in each direction
  scan_range_multiplier: 2

  # max_gap_between_ranges: Maximum number of unassigned lines allowed between adjusted ranges
  # Set to 0 to keep ranges flush; increase if limited gaps are acceptable.
  max_gap_between_ranges: 2